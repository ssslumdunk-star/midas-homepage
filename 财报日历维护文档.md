# 财报日历系统维护文档

## 项目概述
**财报日历**是一个显示美股和港股财报发布时间、分析师预测和实际业绩的Web应用。系统提供实时股价对比、分析师目标价追踪和财报后股价波动分析。

## 文件结构
```
/home/midas/projects/midas-homepage/
├── caibaorili.html          # 主应用文件
├── earnings_data.json       # 财报数据文件
├── check_deviations.py      # 分析师目标价偏离度检查工具
├── 财报日历维护文档.md       # 本文档
└── 备份/                   # 历史版本备份目录
```

## 核心文件说明

### 1. caibaorili.html - 主应用文件
- **功能**：Web界面，日历显示，股价数据，交互逻辑
- **当前版本**：v2.9.7
- **关键组件**：
  - 股价数据对象 `currentStockPrices`
  - 日历渲染函数
  - 弹窗详情显示
  - 分析师目标价计算和显示

### 2. earnings_data.json - 数据文件
- **功能**：存储所有财报事件、分析师评论、股价波动数据
- **数据结构**：
  ```json
  {
    "export_time": "2025-09-13T11:35:00.000000",
    "earnings_events": [
      {
        "symbol": "股票代码",
        "company_name": "公司名称",
        "earnings_date": "财报日期",
        "quarter": "季度",
        "fiscal_year": "财政年度",
        "eps_estimate": "每股收益预期",
        "eps_actual": "实际每股收益",
        "analyst_comments": [
          {
            "analyst_name": "分析师姓名",
            "firm": "机构名称",
            "rating": "评级",
            "price_target": "目标价格",
            "comment": "分析师评论",
            "publish_date": "发布日期",
            "source": "信息来源"
          }
        ]
      }
    ]
  }
  ```

### 3. check_deviations.py - 质量检查工具
- **功能**：检查分析师目标价与当前股价的偏离度
- **用途**：数据质量控制，识别异常目标价
- **使用方法**：`python3 check_deviations.py`

## 维护流程

### 日常维护任务

#### 1. 股价更新
**频率**：每个交易日
**步骤**：
1. 更新 `caibaorili.html` 中的 `currentStockPrices` 对象
2. 确保港股用HK$，美股用$表示
3. 注意港股代码格式：5位数字（如 00700.HK）

```javascript
const currentStockPrices = {
    // 美股 (实时价格)
    'AAPL': 234.35, 'MSFT': 500.28,
    // 港股（港币）
    '00700.HK': 643.50, '09988.HK': 151.0
};
```

#### 2. 财报数据更新
**频率**：财报季度
**步骤**：
1. 添加新的财报事件到 `earnings_data.json`
2. 更新已发布财报的实际数据
3. 添加财报后3天股价波动数据

#### 3. 分析师数据维护
**频率**：每周
**重要原则**：
- ⚠️ **目标价偏离度控制**：与当前股价偏离不应超过20%
- 🔍 **数据验证**：使用 `check_deviations.py` 定期检查
- 📊 **来源可靠性**：优先使用知名投行分析师报告

**质量检查命令**：
```bash
cd /home/midas/projects/midas-homepage
python3 check_deviations.py
```

### 数据质量管理

#### 分析师目标价格审核标准
1. **偏离度阈值**：与当前股价偏离超过20%需要审核
2. **审核流程**：
   - 验证分析师报告原文
   - 检查目标价发布时间
   - 考虑市场环境变化
   - 必要时调整至合理范围

#### 历史修正记录（v2.9.7）
- 华润置地：HK$35.0 → HK$12.0（偏离度 294% → 34.8%）
- 比亚迪：HK$410.0 → HK$135.0（偏离度 292% → 29.2%）
- 安踏体育：HK$110.0 → HK$38.0（偏离度 283% → 32.4%）
- 药明生物：HK$68.0 → HK$38.0（偏离度 138% → 33.3%）
- 中石油：HK$6.8 → HK$68.0（偏离度 -89% → 4.3%）

### 版本管理

#### 版本号规则
- 格式：v主版本.次版本.修订版本
- 主版本：重大功能更新
- 次版本：新增功能或数据结构变化
- 修订版本：Bug修复、数据更新

#### 版本更新步骤
1. 修改 `caibaorili.html` 中的版本信息：
   ```html
   <h1 class="title">📊 美股财报日历 v2.9.7</h1>
   <div>版本: v2.9.7 - 2025-09-14 00:30 | 更新说明</div>
   ```

2. 创建备份：
   ```bash
   mkdir -p 备份/v2.9.7_$(date +%Y%m%d)
   cp caibaorili.html earnings_data.json 备份/v2.9.7_$(date +%Y%m%d)/
   ```

### 故障排除

#### 常见问题

1. **股价显示为默认值**
   - **原因**：`currentStockPrices` 中缺少对应股票代码
   - **解决**：添加股票代码和当前价格

2. **分析师目标价显示异常**
   - **原因**：目标价与当前价格偏离过大
   - **解决**：运行 `check_deviations.py` 检查并修正

3. **发布时间显示 undefined**
   - **原因**：JSON数据中缺少 `earnings_time` 字段
   - **解决**：已在v2.9.7中修复，会自动隐藏undefined字段

4. **港股代码格式错误**
   - **原因**：港股代码应为5位数字格式
   - **解决**：确保格式如 "00700.HK" 而非 "0700.HK"

#### 调试工具

1. **浏览器开发者工具**：检查JavaScript错误
2. **数据验证脚本**：`check_deviations.py`
3. **JSON格式验证**：使用在线JSON validator检查数据格式

### 数据来源和更新建议

#### 推荐数据源
- **股价**：Yahoo Finance, 同花顺, 英为财情
- **财报日期**：各公司官网IR页面
- **分析师报告**：Bloomberg, Reuters, 各大投行研报

#### 自动化建议
考虑未来实现：
- 股价API自动更新
- 财报日期爬虫
- 分析师报告RSS订阅

## 联系信息
- **维护者**：Claude Code AI Assistant
- **最后更新**：2025-09-14
- **项目路径**：`/home/midas/projects/midas-homepage/`

## 备注
- 营收数据已在v2.9.6中隐藏，原因是数据准确性问题严重
- 建议建立更严格的数据验证流程后再恢复营收数据显示
- 所有重要修改都应该先在测试环境验证，然后再部署到生产环境